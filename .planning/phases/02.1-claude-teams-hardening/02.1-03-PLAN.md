---
phase: 02.1-claude-teams-hardening
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - get-shit-done/workflows/execute-phase.md
  - agents/gsd-executor.md
  - get-shit-done/workflows/execute-plan.md
autonomous: true

must_haves:
  truths:
    - "When an executor completes its plan, all downstream executors waiting on it receive an UNBLOCKED message via SendMessage"
    - "Downstream executors are identified from the dependency graph, not hardcoded"
    - "The UNBLOCKED message includes which plan completed and what it produced"
  artifacts:
    - path: "get-shit-done/workflows/execute-phase.md"
      provides: "Downstream executor mapping and UNBLOCKED notification protocol"
      contains: "UNBLOCKED"
    - path: "agents/gsd-executor.md"
      provides: "Executor sends UNBLOCKED to downstream after task completion"
      contains: "UNBLOCKED"
    - path: "get-shit-done/workflows/execute-plan.md"
      provides: "Team context section updated with UNBLOCKED sending protocol"
      contains: "UNBLOCKED"
  key_links:
    - from: "agents/gsd-executor.md"
      to: "get-shit-done/workflows/execute-phase.md"
      via: "Executor uses downstream mapping from orchestrator to send UNBLOCKED messages"
      pattern: "SendMessage.*UNBLOCKED"
---

<objective>
Build active unblocking notifications so completing executors send "UNBLOCKED" messages to downstream executors via SendMessage, replacing passive TaskList polling for dependency resolution.

Purpose: Executors currently poll TaskList() to discover when predecessors complete, adding latency. Direct UNBLOCKED notifications provide immediate awareness.
Output: Updated execute-phase.md orchestrator protocol, gsd-executor.md notification behavior, and execute-plan.md team context.
</objective>

<execution_context>
@/Users/naveennegi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/naveennegi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add downstream executor mapping and UNBLOCKED protocol to execute-phase.md</name>
  <files>get-shit-done/workflows/execute-phase.md</files>
  <action>
In `execute-phase.md`, in the TEAM MODE section, after creating all tasks with dependency chains:

1. Add a step to build the downstream executor mapping from the dependency graph:
   ```
   # Build downstream mapping: for each plan, which plans depend on it?
   downstream_map = {}
   For each plan in plan_index:
     For each dep_plan_id in plan.depends_on:
       if dep_plan_id not in downstream_map:
         downstream_map[dep_plan_id] = []
       downstream_map[dep_plan_id].append(plan.id)
   ```

2. Include the downstream mapping in each executor's spawn prompt as `<downstream_executors>`:
   ```
   <downstream_executors>
   When you complete your plan, send UNBLOCKED messages to these downstream executors:
   {For each downstream plan_id in downstream_map[this_plan_id]:}
   - executor-{downstream_plan_id}: waiting for your plan to complete

   Send format:
   SendMessage({ type: "message", recipient: "executor-{downstream_plan_id}",
     content: "UNBLOCKED: Plan {this_plan_id} complete. You may proceed. Key outputs: {from SUMMARY provides}",
     summary: "Plan {this_plan_id} complete, unblocking you" })

   If you have no downstream executors listed, skip this step.
   </downstream_executors>
   ```

3. Update the orchestrator monitoring section to note that UNBLOCKED messages supplement (not replace) TaskList dependency tracking, which is the authoritative source of truth.
  </action>
  <verify>
Read execute-phase.md and verify: downstream_map construction exists, executor spawn prompts include downstream_executors section, monitoring notes UNBLOCKED supplements TaskList.
  </verify>
  <done>execute-phase.md builds downstream mapping from dependency graph and passes it to each executor for UNBLOCKED notifications.</done>
</task>

<task type="auto">
  <name>Task 2: Add UNBLOCKED notification behavior to gsd-executor.md and execute-plan.md</name>
  <files>agents/gsd-executor.md, get-shit-done/workflows/execute-plan.md</files>
  <action>
In `gsd-executor.md`, in the `<team_communication_protocol>` section under "Executor-Specific Team Behavior", add:

```markdown
### Active Unblocking
- After marking your task as completed, send UNBLOCKED notifications to downstream executors listed in your `<downstream_executors>` prompt section:
  `SendMessage({ type: "message", recipient: "executor-{plan_id}", content: "UNBLOCKED: Plan {your_plan_id} complete. Key outputs: {brief summary of what was created}. You may now proceed.", summary: "Plan {your_plan_id} done, unblocking you" })`
- If no downstream executors are listed, skip this step
- UNBLOCKED is a courtesy notification â€” task dependency tracking via TaskList is the authoritative mechanism
```

In `execute-plan.md`, in the `<team_context>` section, add a point after the Completion item:

```markdown
6. **Active Unblocking:** After marking task completed, if your spawn prompt includes `<downstream_executors>`, send UNBLOCKED messages to each listed executor. Include what your plan produced (from SUMMARY.md provides section) so downstream executors know what's available.
```
  </action>
  <verify>
Read gsd-executor.md and verify "Active Unblocking" section exists in team communication protocol. Read execute-plan.md and verify point 6 about UNBLOCKED in team_context.
  </verify>
  <done>Executors send UNBLOCKED messages to downstream executors on completion with summary of outputs produced.</done>
</task>

</tasks>

<verification>
1. execute-phase.md builds downstream mapping from dependency graph
2. Executor spawn prompts include downstream_executors section
3. gsd-executor.md documents UNBLOCKED notification behavior
4. execute-plan.md team context includes active unblocking step
5. All notifications are supplements to TaskList (not replacements)
</verification>

<success_criteria>
Completing executors send "UNBLOCKED" notifications to downstream executors via SendMessage instead of relying on polling.
</success_criteria>

<output>
After completion, create `.planning/phases/02.1-claude-teams-hardening/02.1-03-SUMMARY.md`
</output>
