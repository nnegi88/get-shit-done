---
phase: 02.1-claude-teams-hardening
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - agents/gsd-plan-checker.md
  - get-shit-done/workflows/plan-phase.md
  - agents/gsd-planner.md
autonomous: true

must_haves:
  truths:
    - "Revision loop iterations adapt based on issue severity: fewer iterations for info-only issues, standard for warnings, extended for blockers"
    - "Revision loop terminates early when issues are not decreasing between iterations (convergence detection)"
    - "Maximum iterations is configurable per severity tier rather than a fixed cap"
  artifacts:
    - path: "agents/gsd-plan-checker.md"
      provides: "Severity-based iteration recommendation and convergence tracking"
      contains: "convergence"
    - path: "get-shit-done/workflows/plan-phase.md"
      provides: "Adaptive iteration limits and early termination logic"
      contains: "convergence"
    - path: "agents/gsd-planner.md"
      provides: "Updated revision mode with severity awareness"
      contains: "severity"
  key_links:
    - from: "agents/gsd-plan-checker.md"
      to: "get-shit-done/workflows/plan-phase.md"
      via: "Checker returns iteration recommendation with issues; orchestrator uses it to decide max iterations"
      pattern: "iteration_recommendation"
---

<objective>
Make the plan revision loop adaptive based on issue severity and add convergence tracking to terminate early when issues aren't decreasing.

Purpose: Hardcoded 3-iteration cap is too rigid. Minor info-only issues don't need 3 rounds, while critical blockers might benefit from additional passes. Convergence detection prevents wasting iterations when the same issues keep recurring.
Output: Updated checker with severity-based iteration guidance, plan-phase.md with adaptive loop, and planner with severity awareness.
</objective>

<execution_context>
@/Users/naveennegi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/naveennegi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add severity-based iteration guidance to gsd-plan-checker.md</name>
  <files>agents/gsd-plan-checker.md</files>
  <action>
In `gsd-plan-checker.md`, after the `<issue_structure>` section, add a new section:

```markdown
<iteration_guidance>
## Adaptive Iteration Recommendation

After collecting all issues, include an iteration recommendation in your output:

### Severity Tiers

| Highest Severity | Recommended Max Iterations | Rationale |
|------------------|---------------------------|-----------|
| info only | 1 | Suggestions only — one pass sufficient |
| warning (no blockers) | 2 | Should fix but not critical — two passes |
| blocker present | 3 | Must fix — standard three-pass loop |

### Convergence Tracking

When re-verifying (iteration 2+):
1. Compare current issue count to previous iteration count
2. If issue count has NOT decreased: include `convergence: stalled` in your output
3. If issue count decreased: include `convergence: improving`
4. If new issues appeared that weren't in previous set: include `convergence: regressing`

Include in your structured return:
\```yaml
iteration_guidance:
  highest_severity: blocker|warning|info
  recommended_max: 3
  current_issue_count: N
  previous_issue_count: M  # null on first check
  convergence: improving|stalled|regressing|first_check
\```

### Early Termination Signal

If convergence is "stalled" or "regressing" on iteration 2+, include in your message to the planner:
"Note: Issues are not converging. Consider focusing on the {N} remaining blockers and accepting warnings."

When reporting to orchestrator (team mode task completion or subagent return), include this guidance so the orchestrator can decide whether to continue iterations.
</iteration_guidance>
```

Update the `<structured_returns>` section for ISSUES FOUND to include the iteration_guidance block in the output.

Update the checker's team_instructions in team_communication_protocol to track iteration count and include convergence data in messages to the planner.
  </action>
  <verify>
Read gsd-plan-checker.md and verify: iteration_guidance section exists with severity tiers, convergence tracking, early termination signal. Structured returns updated with iteration_guidance block.
  </verify>
  <done>Checker includes severity-based iteration recommendation and convergence tracking in all issue reports.</done>
</task>

<task type="auto">
  <name>Task 2: Add adaptive loop control to plan-phase.md and severity awareness to gsd-planner.md</name>
  <files>get-shit-done/workflows/plan-phase.md, agents/gsd-planner.md</files>
  <action>
In `plan-phase.md`:

1. **Team mode (section 8c monitoring):** Update the monitoring logic to parse `iteration_guidance` from the checker's task completion message:
   ```
   if checker_task.status == "completed":
     if "VERIFICATION PASSED": break (success)
     if "ISSUES REMAIN":
       Parse iteration_guidance from completion message
       if convergence == "stalled" or convergence == "regressing":
         Display: "Revision loop not converging. {issue_count} issues remain."
         Offer: 1) Force proceed, 2) Provide guidance, 3) Abandon
         break
       # Otherwise, the planner-checker direct loop handles iterations
   ```

2. **Team mode task instructions:** Update the checker and planner team_instructions to include adaptive limits:
   ```
   Revision loop limits (adaptive):
   - info-only issues: Maximum 1 iteration
   - warning issues (no blockers): Maximum 2 iterations
   - blocker issues: Maximum 3 iterations
   Track convergence: if issues aren't decreasing, terminate early with "ISSUES REMAIN"
   ```

3. **Fallback mode (Step 10):** Update the revision loop to use adaptive limits:
   ```
   # Parse iteration_guidance from checker return
   max_iterations = recommended_max from iteration_guidance (default 3)

   If convergence == "stalled" or "regressing":
     Display: "Issues not converging after {iteration_count} iterations."
     Offer options (same as current max-iteration handling)
   ```

In `gsd-planner.md`, in the `<revision_mode>` section, add:
```markdown
### Severity-Aware Revision
When receiving checker issues with severity levels:
- **Blockers first:** Address all blockers before warnings
- **Convergence awareness:** If checker notes convergence is stalled, focus on remaining blockers and document why warnings are acceptable rather than trying to fix everything
- **Iteration budget:** Be aware the iteration budget may be less than 3 for minor issues
```
  </action>
  <verify>
Read plan-phase.md and verify adaptive limits in both team mode and fallback mode. Read gsd-planner.md and verify severity-aware revision guidance.
  </verify>
  <done>Revision loop adapts iterations based on severity and terminates early when convergence stalls.</done>
</task>

</tasks>

<verification>
1. gsd-plan-checker.md includes iteration_guidance with severity tiers and convergence tracking
2. plan-phase.md team mode uses iteration_guidance for loop control
3. plan-phase.md fallback mode uses adaptive max_iterations
4. gsd-planner.md includes severity-aware revision guidance
5. Convergence stall/regression triggers early termination
</verification>

<success_criteria>
Revision loop iterations adapt based on issue severity (fewer for minor, more for blockers) and terminate early when issues aren't converging.
</success_criteria>

<output>
After completion, create `.planning/phases/02.1-claude-teams-hardening/02.1-05-SUMMARY.md`
</output>
