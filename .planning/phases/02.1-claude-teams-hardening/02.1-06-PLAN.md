---
phase: 02.1-claude-teams-hardening
plan: 06
type: execute
wave: 2
depends_on: ["02.1-04"]
files_modified:
  - get-shit-done/bin/gsd-tools.js
  - get-shit-done/workflows/execute-phase.md
  - get-shit-done/workflows/resume-project.md
autonomous: true

must_haves:
  truths:
    - "Interrupted phase execution can be resumed from where it stopped, skipping completed plans"
    - "A .planning/.team-checkpoint.json file persists execution state (completed plans, current wave, plan statuses)"
    - "On restart, the orchestrator reads the checkpoint file and creates a new team for remaining plans only"
  artifacts:
    - path: "get-shit-done/bin/gsd-tools.js"
      provides: "team-checkpoint write/read/clear commands"
      contains: "team-checkpoint"
    - path: "get-shit-done/workflows/execute-phase.md"
      provides: "Checkpoint writing on plan completion and reading on restart"
      contains: "team-checkpoint"
    - path: "get-shit-done/workflows/resume-project.md"
      provides: "Team checkpoint awareness in resume flow"
      contains: "team-checkpoint"
  key_links:
    - from: "get-shit-done/workflows/execute-phase.md"
      to: "get-shit-done/bin/gsd-tools.js"
      via: "Orchestrator writes checkpoint after each plan completion, reads on restart"
      pattern: "team-checkpoint"
    - from: "get-shit-done/workflows/resume-project.md"
      to: "get-shit-done/bin/gsd-tools.js"
      via: "Resume workflow checks for team checkpoint to offer continuation"
      pattern: "team-checkpoint"
---

<objective>
Implement session resumption via `.planning/.team-checkpoint.json` so interrupted phase execution can resume from where it stopped, skipping completed plans.

Purpose: If execution is interrupted (crash, user exit, network issue), there's no way to resume from where it stopped — the entire phase must re-execute. Checkpoint files allow picking up exactly where execution left off.
Output: New gsd-tools.js team-checkpoint commands, execute-phase.md checkpoint writing/reading, and resume-project.md awareness.
</objective>

<execution_context>
@/Users/naveennegi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/naveennegi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02.1-claude-teams-hardening/02.1-04-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add team-checkpoint write/read/clear commands to gsd-tools.js</name>
  <files>get-shit-done/bin/gsd-tools.js</files>
  <action>
Add three new subcommands under a `team-checkpoint` command group:

1. **`team-checkpoint write --phase <phase> --plan <plan_id> --status <completed|failed|in_progress>`**
   - Reads existing `.planning/.team-checkpoint.json` or creates new
   - Updates/adds entry for the specified plan
   - File structure:
     ```json
     {
       "phase": "02.1-claude-teams-hardening",
       "started_at": "ISO timestamp",
       "updated_at": "ISO timestamp",
       "plans": {
         "02.1-01": { "status": "completed", "summary_exists": true, "completed_at": "ISO" },
         "02.1-02": { "status": "in_progress", "started_at": "ISO" },
         "02.1-03": { "status": "pending" }
       },
       "completed_count": 1,
       "total_count": 3
     }
     ```
   - On first write, initialize with all plans from phase (status: "pending")
   - On subsequent writes, update the specified plan's status

2. **`team-checkpoint read`**
   - Reads `.planning/.team-checkpoint.json`
   - Returns the full JSON content
   - If file doesn't exist: `{ exists: false }`

3. **`team-checkpoint clear`**
   - Removes `.planning/.team-checkpoint.json`
   - Returns `{ cleared: true }`

Handle edge cases: missing .planning/ directory, corrupted JSON (re-create), concurrent writes (atomic write via temp file + rename).
  </action>
  <verify>
Run team-checkpoint write, read, and clear commands:
```bash
node gsd-tools.js team-checkpoint write --phase "02.1" --plan "02.1-01" --status completed
node gsd-tools.js team-checkpoint read
node gsd-tools.js team-checkpoint clear
```
Verify JSON structure is correct. Run `npm test` for regressions.
  </verify>
  <done>team-checkpoint write/read/clear commands manage .planning/.team-checkpoint.json with plan completion tracking.</done>
</task>

<task type="auto">
  <name>Task 2: Integrate checkpoint writing/reading into execute-phase.md and resume-project.md</name>
  <files>get-shit-done/workflows/execute-phase.md, get-shit-done/workflows/resume-project.md</files>
  <action>
In `execute-phase.md`:

1. **At the start of execute_waves (both team and fallback modes):** Initialize checkpoint:
   ```bash
   # Check for existing checkpoint (resumption)
   CHECKPOINT=$(node gsd-tools.js team-checkpoint read)
   if checkpoint.exists:
     Display: "Found interrupted execution checkpoint for Phase {phase}"
     Display: "{completed_count}/{total_count} plans completed"
     # Filter plan list to only incomplete plans
     incomplete_plans = plans where checkpoint.plans[id].status != "completed"
     Display: "Resuming from: {first incomplete plan}"
   else:
     # Initialize checkpoint with all plans
     for each plan:
       node gsd-tools.js team-checkpoint write --phase "{phase}" --plan "{plan_id}" --status pending
   ```

2. **After each plan completes (in monitoring loop for team mode, after each subagent for fallback mode):**
   ```bash
   node gsd-tools.js team-checkpoint write --phase "{phase}" --plan "{plan_id}" --status completed
   ```

3. **After successful phase completion (after verification):**
   ```bash
   node gsd-tools.js team-checkpoint clear
   ```

4. **On failure (plan fails, user aborts):** Leave checkpoint file in place for future resumption.

In `resume-project.md`, in the `load_state` step, add after loading STATE.md:
```markdown
**Check for interrupted team execution:**
\```bash
CHECKPOINT=$(node gsd-tools.js team-checkpoint read)
\```

If checkpoint exists:
\```
⚠️  INTERRUPTED EXECUTION DETECTED

Phase {phase}: {completed_count}/{total_count} plans completed
Last update: {updated_at}

Options:
1. Resume execution: `/gsd:execute-phase {phase}` (will pick up where it stopped)
2. Start fresh: Delete checkpoint and re-execute
3. View progress: Show completed/pending plans
\```
```
  </action>
  <verify>
Read execute-phase.md and verify checkpoint init, write-on-complete, and clear-on-success. Read resume-project.md and verify checkpoint detection and user options.
  </verify>
  <done>Execution writes checkpoints on plan completion, reads them on restart to skip completed plans, and resume-project.md detects interrupted execution.</done>
</task>

</tasks>

<verification>
1. `npm test` passes with no regressions
2. team-checkpoint commands produce correct JSON
3. execute-phase.md initializes, updates, and clears checkpoints
4. Interrupted execution detected and plans resumed from checkpoint
5. resume-project.md detects and offers to resume interrupted execution
</verification>

<success_criteria>
Interrupted phase execution can be resumed from where it stopped, skipping completed plans.
</success_criteria>

<output>
After completion, create `.planning/phases/02.1-claude-teams-hardening/02.1-06-SUMMARY.md`
</output>
