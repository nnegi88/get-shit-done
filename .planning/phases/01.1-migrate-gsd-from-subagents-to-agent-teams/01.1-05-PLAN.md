---
phase: 01.1-migrate-gsd-from-subagents-to-agent-teams
plan: 05
type: execute
wave: 3
depends_on: [01.1-02, 01.1-03, 01.1-04]
files_modified:
  - ~/.claude/get-shit-done/workflows/diagnose-issues.md
autonomous: true

must_haves:
  truths:
    - "Debug workflow creates a team with 3 hypothesis investigators that actively challenge each other's findings"
    - "Investigators message each other to challenge hypotheses with counter-evidence"
    - "Team lead synthesizes which hypothesis survived peer review"
    - "All existing GSD guarantees are preserved across all 4 migrated workflows (atomic commits, state tracking, deviation rules, goal-backward verification)"
    - "Fallback to subagent mode works for the debug workflow"
  artifacts:
    - path: "~/.claude/get-shit-done/workflows/diagnose-issues.md"
      provides: "Team-based debug workflow with competing hypothesis pattern"
      contains: "TeamCreate"
  key_links:
    - from: "~/.claude/get-shit-done/workflows/diagnose-issues.md"
      to: "~/.claude/agents/gsd-debugger.md"
      via: "Task() spawn with team_name for hypothesis investigators"
      pattern: "team_name.*gsd-debug"
---

<objective>
Create the debug team workflow with competing hypotheses pattern and verify all existing GSD guarantees are preserved across all 4 migrated workflows.

Purpose: The debug workflow is the most novel migration — replacing a single debugger agent with 3 competing hypothesis investigators that actively challenge each other's findings. This plan also performs integration verification to ensure the migration hasn't broken any existing GSD guarantees (atomic commits, state tracking, deviation rules, goal-backward verification, file artifacts as source of truth).

Output: Updated diagnose-issues.md with team-based competing hypotheses, integration verification of all workflows.
</objective>

<execution_context>
@/Users/naveennegi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/naveennegi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01.1-migrate-gsd-from-subagents-to-agent-teams/01.1-RESEARCH.md
@.planning/phases/01.1-migrate-gsd-from-subagents-to-agent-teams/CONTEXT.md
@.planning/phases/01.1-migrate-gsd-from-subagents-to-agent-teams/01.1-02-SUMMARY.md
@.planning/phases/01.1-migrate-gsd-from-subagents-to-agent-teams/01.1-03-SUMMARY.md
@.planning/phases/01.1-migrate-gsd-from-subagents-to-agent-teams/01.1-04-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create debug team workflow with competing hypotheses pattern</name>
  <files>
    ~/.claude/get-shit-done/workflows/diagnose-issues.md
  </files>
  <action>
    Read the existing `diagnose-issues.md` workflow to understand its current structure. Then add a team-based competing hypotheses mode while preserving the existing single-debugger flow as fallback.

    **The competing hypotheses pattern:**

    When a debug session starts (via `/gsd:debug` or `diagnose-issues` workflow), if Agent Teams is available, create a debug team with 3 investigators instead of 1 debugger:

    ```
    ## Team-Based Debug (Competing Hypotheses)

    TeamCreate({ team_name: "gsd-debug-{issue_slug}", description: "Debug team for: {issue_description}" })

    If TeamCreate succeeds — TEAM MODE:
    ```

    **Create investigation tasks:**

    ```
    # 3 parallel hypothesis investigation tasks
    hyp1_task = TaskCreate({
      subject: "Investigate hypothesis 1: {derived_hypothesis_1}",
      description: "Investigate whether {hypothesis_1} explains the symptoms. Gather evidence for and against. Challenge other investigators' findings.",
      activeForm: "Investigating hypothesis 1"
    })

    hyp2_task = TaskCreate({
      subject: "Investigate hypothesis 2: {derived_hypothesis_2}",
      description: "Investigate whether {hypothesis_2} explains the symptoms. Gather evidence for and against. Challenge other investigators' findings.",
      activeForm: "Investigating hypothesis 2"
    })

    hyp3_task = TaskCreate({
      subject: "Investigate hypothesis 3: {derived_hypothesis_3}",
      description: "Investigate whether {hypothesis_3} explains the symptoms. Gather evidence for and against. Challenge other investigators' findings.",
      activeForm: "Investigating hypothesis 3"
    })
    ```

    **Derive initial hypotheses:** The orchestrator (or team lead) derives 3 initial hypotheses from the bug report symptoms before spawning investigators. Use the scientific debugging method from gsd-debugger.md:
    1. Analyze symptoms reported by user
    2. Generate 3 distinct hypotheses that could explain ALL symptoms
    3. Each hypothesis should be independently testable

    **Spawn investigator teammates:**

    ```
    Task(
      team_name: "gsd-debug-{issue_slug}",
      name: "investigator-1",
      subagent_type: "gsd-debugger",
      prompt: "First, read /Users/naveennegi/.claude/agents/gsd-debugger.md for your role.\n\nYou are investigator-1 on a debug team. You are investigating hypothesis: '{hypothesis_1}'.\n\n**Competing Hypotheses Protocol:**\n- Investigate your hypothesis using scientific method (observe, hypothesize, predict, test)\n- When you find evidence, broadcast it so other investigators can evaluate:\n  SendMessage({ type: 'broadcast', content: 'Evidence: {finding}. Supports/contradicts hypotheses: {list}', summary: 'Evidence found' })\n- When another investigator shares evidence, evaluate how it affects YOUR hypothesis\n- Actively challenge other hypotheses if your evidence contradicts them:\n  SendMessage({ type: 'message', recipient: 'investigator-{N}', content: 'Your hypothesis does not explain {symptom} because {evidence}', summary: 'Challenging hypothesis' })\n- When challenged, defend with evidence or acknowledge and revise\n- When investigation is complete, summarize: hypothesis confirmed/eliminated/inconclusive with evidence\n\n**Bug Report:**\n{bug_symptoms}\n\n**Codebase context:**\n{relevant_file_paths}"
    )

    // Same pattern for investigator-2 and investigator-3 with their respective hypotheses
    ```

    **Orchestrator synthesis (team lead):**

    After all 3 investigators complete their tasks:
    1. Read each investigator's findings (from their task completion messages or debug files)
    2. Determine which hypothesis survived peer review:
       - Hypothesis confirmed by evidence AND not contradicted by other evidence = likely root cause
       - Hypothesis eliminated by evidence = ruled out
       - Multiple hypotheses surviving = may be compound root cause
    3. Present synthesis to user:

    ```
    ## Debug Team Results

    **Issue:** {description}

    | Hypothesis | Investigator | Status | Key Evidence |
    |-----------|-------------|--------|--------------|
    | {H1} | investigator-1 | Confirmed/Eliminated | {evidence} |
    | {H2} | investigator-2 | Confirmed/Eliminated | {evidence} |
    | {H3} | investigator-3 | Confirmed/Eliminated | {evidence} |

    **Root Cause:** {surviving hypothesis with highest evidence support}
    **Confidence:** {HIGH/MEDIUM/LOW based on evidence consensus}

    **Peer Review Summary:**
    - {which challenges were made and how they were resolved}
    ```

    4. Offer: Fix the issue? / Investigate further? / Close debug session

    **Shutdown:**
    ```
    For each investigator:
      SendMessage({ type: "shutdown_request", ... })
    TeamDelete()
    ```

    **If TeamCreate fails — FALLBACK to current single-debugger mode:**

    Display: `Agent Teams unavailable. Using single debugger mode.`

    Execute the existing diagnose-issues workflow (single gsd-debugger subagent). Preserve existing code verbatim as fallback.

    **Preserve existing behaviors:**
    - Debug file state persistence (survives context resets)
    - Structured returns (ROOT CAUSE FOUND, DEBUG COMPLETE, CHECKPOINT REACHED)
    - Checkpoint handling for user input
    - All existing diagnose-issues functionality outside of agent spawning
  </action>
  <verify>
    1. `grep "TeamCreate" ~/.claude/get-shit-done/workflows/diagnose-issues.md` finds team creation
    2. `grep "competing.*hypothes\|hypothesis.*investigat" ~/.claude/get-shit-done/workflows/diagnose-issues.md` finds competing hypotheses pattern
    3. `grep "challenge\|broadcast.*evidence" ~/.claude/get-shit-done/workflows/diagnose-issues.md` finds inter-investigator challenging
    4. `grep "TeamDelete" ~/.claude/get-shit-done/workflows/diagnose-issues.md` finds cleanup
    5. `grep "fallback\|single.*debugger\|subagent mode" ~/.claude/get-shit-done/workflows/diagnose-issues.md` finds fallback path
  </verify>
  <done>
    diagnose-issues.md creates a debug team with 3 hypothesis investigators that challenge each other's findings via messaging. The team lead synthesizes which hypothesis survived peer review. Falls back to single-debugger subagent mode if TeamCreate fails.
  </done>
</task>

<task type="auto">
  <name>Task 2: Integration verification — audit all 4 migrated workflows for GSD guarantee preservation</name>
  <files>
    ~/.claude/get-shit-done/workflows/plan-phase.md
    ~/.claude/get-shit-done/workflows/execute-phase.md
    ~/.claude/get-shit-done/workflows/execute-plan.md
    ~/.claude/get-shit-done/workflows/new-project.md
    ~/.claude/get-shit-done/workflows/diagnose-issues.md
  </files>
  <action>
    Read all 4 migrated workflow files and all 11 agent definitions. Verify that the migration has not broken any existing GSD guarantees. This is an audit task — fix any issues found.

    **Guarantee checklist (verify each across all workflows):**

    1. **Atomic commits:** Executor tasks still commit per-task (not per-plan or per-wave). Verify execute-plan.md and execute-phase.md preserve git commit protocol.

    2. **State tracking:** STATE.md is still updated by executors after each plan completion. Verify execute-plan.md still updates STATE.md.

    3. **Deviation rules (1-4):** Executor agent definition still contains deviation rules. Verify gsd-executor.md's deviation handling is unchanged.

    4. **Goal-backward verification:** Verifier still checks must_haves against codebase. Verify execute-phase.md still spawns verifier (as teammate or subagent). Verify gsd-verifier.md's core verification process is unchanged.

    5. **File-based artifacts as source of truth:** All workflows still produce RESEARCH.md, PLAN.md, SUMMARY.md, VERIFICATION.md. Verify no workflow relies solely on team messages for persistent state.

    6. **Checkpoint protocol:** Checkpoint plans still pause for user interaction. Verify execute-phase.md handles checkpoints in both team and fallback modes.

    7. **CONTEXT.md user decisions:** Locked decisions still flow to researcher, planner, and checker. Verify plan-phase.md passes context_content to all teammates.

    8. **Wave-based parallelization:** Plans still execute in wave order (parallel within wave, sequential between waves). Verify execute-phase.md preserves wave ordering in both modes.

    9. **gsd-tools.js CLI unchanged:** Verify no workflow modifications reference new gsd-tools.js commands (the CLI is unchanged per locked decision).

    10. **User-facing slash commands unchanged:** Verify no new slash commands were introduced and existing ones still map to the same workflows.

    11. **Graceful fallback in all workflows:** Verify plan-phase.md, execute-phase.md, new-project.md, and diagnose-issues.md all have fallback paths that work identically to the pre-migration behavior.

    12. **Shutdown cleanup in all workflows:** Verify all team mode paths end with shutdown_request to all teammates followed by TeamDelete().

    **If any guarantee is violated:** Fix the offending workflow file to restore the guarantee. Document the fix.

    **If any agent definition lost content during Plan 01:** Restore the missing content. The team_communication_protocol section should be APPENDED, not replace existing content.
  </action>
  <verify>
    For each guarantee:
    1. Atomic commits: `grep "commit.*atomically\|per-task commit" ~/.claude/get-shit-done/workflows/execute-plan.md` returns results
    2. State tracking: `grep "STATE.md" ~/.claude/get-shit-done/workflows/execute-plan.md` returns results
    3. Deviation rules: `grep "deviation" ~/.claude/agents/gsd-executor.md` returns results
    4. Goal-backward: `grep "must_haves\|goal.backward" ~/.claude/agents/gsd-verifier.md` returns results
    5. File artifacts: `grep "RESEARCH.md\|PLAN.md\|SUMMARY.md\|VERIFICATION.md" ~/.claude/get-shit-done/workflows/plan-phase.md` returns results
    6. Checkpoints: `grep "checkpoint" ~/.claude/get-shit-done/workflows/execute-phase.md` returns results
    7. CONTEXT.md: `grep "context_content\|CONTEXT.md" ~/.claude/get-shit-done/workflows/plan-phase.md` returns results
    8. Wave ordering: `grep "wave\|addBlockedBy" ~/.claude/get-shit-done/workflows/execute-phase.md` returns results
    9. No new CLI commands: `grep "gsd-tools.js" ~/.claude/get-shit-done/workflows/*.md | grep -v "existing commands"` — no new commands
    10. Fallback: `grep "fallback\|FALLBACK" ~/.claude/get-shit-done/workflows/plan-phase.md ~/.claude/get-shit-done/workflows/execute-phase.md ~/.claude/get-shit-done/workflows/new-project.md ~/.claude/get-shit-done/workflows/diagnose-issues.md` — all 4 have fallback
    11. Shutdown: `grep "TeamDelete" ~/.claude/get-shit-done/workflows/plan-phase.md ~/.claude/get-shit-done/workflows/execute-phase.md ~/.claude/get-shit-done/workflows/new-project.md ~/.claude/get-shit-done/workflows/diagnose-issues.md` — all 4 have cleanup
  </verify>
  <done>
    All 12 GSD guarantees verified across all 4 migrated workflows. Any violations found during audit have been fixed. The migration preserves atomic commits, state tracking, deviation rules, goal-backward verification, file-based artifacts, checkpoint protocol, CONTEXT.md user decisions, wave ordering, CLI stability, slash command interface, graceful fallback, and shutdown cleanup.
  </done>
</task>

</tasks>

<verification>
1. diagnose-issues.md creates a debug team with 3 competing hypothesis investigators
2. Investigators challenge each other's hypotheses via messaging
3. Team lead synthesizes results and presents which hypothesis survived
4. Fallback to single-debugger mode works
5. All 12 GSD guarantees verified across all 4 migrated workflows
6. No existing agent content was lost during migration
7. All workflows have proper shutdown and TeamDelete sequences
</verification>

<success_criteria>
The debug workflow uses competing hypotheses with peer-reviewed investigation, and all 4 migrated workflows preserve every existing GSD guarantee with proper fallback and cleanup.
</success_criteria>

<output>
After completion, create `.planning/phases/01.1-migrate-gsd-from-subagents-to-agent-teams/01.1-05-SUMMARY.md`
</output>
