---
phase: 01.1-migrate-gsd-from-subagents-to-agent-teams
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - ~/.claude/agents/gsd-executor.md
  - ~/.claude/agents/gsd-planner.md
  - ~/.claude/agents/gsd-verifier.md
  - ~/.claude/agents/gsd-phase-researcher.md
  - ~/.claude/agents/gsd-plan-checker.md
  - ~/.claude/agents/gsd-debugger.md
  - ~/.claude/agents/gsd-project-researcher.md
  - ~/.claude/agents/gsd-research-synthesizer.md
  - ~/.claude/agents/gsd-roadmapper.md
  - ~/.claude/agents/gsd-integration-checker.md
  - ~/.claude/agents/gsd-codebase-mapper.md
  - ~/.claude/settings.json
autonomous: true

must_haves:
  truths:
    - "Every agent definition has a <team_communication_protocol> section"
    - "Agents know how to claim tasks via TaskUpdate, message teammates via SendMessage, and respond to shutdown requests"
    - "Settings.json has teammateMode configured for in-process teammates"
    - "Single-agent agents (roadmapper, codebase-mapper) have minimal team awareness with note about standalone operation"
  artifacts:
    - path: "~/.claude/agents/gsd-executor.md"
      provides: "Team-aware executor with broadcast pattern for shared dependency warnings"
      contains: "<team_communication_protocol>"
    - path: "~/.claude/agents/gsd-planner.md"
      provides: "Team-aware planner with follow-up questioning and revision messaging"
      contains: "<team_communication_protocol>"
    - path: "~/.claude/agents/gsd-verifier.md"
      provides: "Team-aware verifier that can query executors about discrepancies"
      contains: "<team_communication_protocol>"
    - path: "~/.claude/agents/gsd-phase-researcher.md"
      provides: "Team-aware researcher that responds to follow-up questions"
      contains: "<team_communication_protocol>"
    - path: "~/.claude/agents/gsd-plan-checker.md"
      provides: "Team-aware checker with direct messaging to planner"
      contains: "<team_communication_protocol>"
    - path: "~/.claude/agents/gsd-debugger.md"
      provides: "Team-aware debugger for competing hypothesis challenges"
      contains: "<team_communication_protocol>"
    - path: "~/.claude/settings.json"
      provides: "Agent Teams configuration with in-process teammate mode"
      contains: "teammateMode"
  key_links:
    - from: "~/.claude/agents/gsd-plan-checker.md"
      to: "~/.claude/agents/gsd-planner.md"
      via: "SendMessage direct messaging for revision loop"
      pattern: "SendMessage.*recipient.*planner"
    - from: "~/.claude/agents/gsd-phase-researcher.md"
      to: "~/.claude/agents/gsd-planner.md"
      via: "SendMessage for follow-up responses"
      pattern: "SendMessage.*recipient"
---

<objective>
Add Team Communication Protocol to all 11 GSD agent definitions and configure settings.json for Agent Teams.

Purpose: Agents need team awareness before workflows can use them as teammates. This is the foundation — without Team Communication Protocol sections, spawned teammates will complete work but never message the team, never update tasks, and never respond to shutdown requests.

Output: All 11 agent .md files updated with <team_communication_protocol> section, settings.json updated with teammateMode.
</objective>

<execution_context>
@/Users/naveennegi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/naveennegi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01.1-migrate-gsd-from-subagents-to-agent-teams/01.1-RESEARCH.md
@.planning/phases/01.1-migrate-gsd-from-subagents-to-agent-teams/CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Team Communication Protocol to all 11 agent definitions</name>
  <files>
    ~/.claude/agents/gsd-executor.md
    ~/.claude/agents/gsd-planner.md
    ~/.claude/agents/gsd-verifier.md
    ~/.claude/agents/gsd-phase-researcher.md
    ~/.claude/agents/gsd-plan-checker.md
    ~/.claude/agents/gsd-debugger.md
    ~/.claude/agents/gsd-project-researcher.md
    ~/.claude/agents/gsd-research-synthesizer.md
    ~/.claude/agents/gsd-roadmapper.md
    ~/.claude/agents/gsd-integration-checker.md
    ~/.claude/agents/gsd-codebase-mapper.md
  </files>
  <action>
    Add a `<team_communication_protocol>` section to each agent definition, placed AFTER the closing tag of the last existing section in each file. The protocol section must teach agents how to operate as teammates when spawned into a team.

    **For all 11 agents, the base protocol includes:**

    ```xml
    <team_communication_protocol>
    ## When You Are a Teammate

    When spawned into a team (you will see team context in your session):

    ### Task Management
    1. On start: `TaskList()` to see available tasks
    2. Claim your task: `TaskUpdate({ taskId: "N", status: "in_progress", owner: "your-name" })`
    3. On completion: `TaskUpdate({ taskId: "N", status: "completed" })`
    4. After completing: `TaskList()` to check for next available work

    ### Messaging
    - **Direct message:** `SendMessage({ type: "message", recipient: "teammate-name", content: "...", summary: "..." })`
    - **Broadcast (use sparingly):** `SendMessage({ type: "broadcast", content: "...", summary: "..." })`
    - **Shutdown response:** When you receive a shutdown request JSON message with `type: "shutdown_request"`, respond with:
      `SendMessage({ type: "shutdown_response", request_id: "...", approve: true })`

    ### Communication Guidelines
    - Your plain text output is NOT visible to teammates — you MUST use SendMessage to communicate
    - Message teammates when you discover something relevant to their task
    - Ask follow-up questions rather than making assumptions
    - Keep messages concise with enough context to be actionable
    - After receiving a message, always respond via SendMessage

    ### File Artifacts
    - Still write RESEARCH.md / PLAN.md / SUMMARY.md as before
    - Files remain the persistent state layer (survive session loss)
    - Messages are ephemeral; important decisions should also go in files
    </team_communication_protocol>
    ```

    **Agent-specific additions (append inside the protocol section, before closing tag):**

    **gsd-executor.md** — Add after Communication Guidelines:
    ```
    ### Executor-Specific Team Behavior
    - When modifying files listed in another plan's `files_modified`, broadcast a warning:
      `SendMessage({ type: "broadcast", content: "WARNING: Modified {filepath} which is in another plan's scope. Check your imports.", summary: "{filepath} modified" })`
    - After completing each task, update the team task to reflect progress
    - If a task fails, message the team lead with the failure details before marking task failed
    ```

    **gsd-planner.md** — Add after Communication Guidelines:
    ```
    ### Planner-Specific Team Behavior
    - When you need clarification from the researcher, message them directly:
      `SendMessage({ type: "message", recipient: "researcher", content: "Your RESEARCH.md mentions X but I need to know Y for planning. Can you clarify?", summary: "Requesting research clarification" })`
    - When checker sends issues, address them and message back:
      `SendMessage({ type: "message", recipient: "checker", content: "Revised plans addressing your {N} issues. Please re-verify.", summary: "Plans revised, requesting re-check" })`
    - When revision is complete, update your task status and notify the team
    ```

    **gsd-phase-researcher.md** — Add after Communication Guidelines:
    ```
    ### Researcher-Specific Team Behavior
    - If the planner messages you with follow-up questions, respond via SendMessage with the answer
    - When you discover something that affects the planner's approach, proactively message them:
      `SendMessage({ type: "message", recipient: "planner", content: "Research finding: {detail}. This affects how you should plan task X.", summary: "Research finding affecting planning" })`
    - Write RESEARCH.md as usual — the file is the persistent artifact, messages are for coordination
    ```

    **gsd-plan-checker.md** — Add after Communication Guidelines:
    ```
    ### Checker-Specific Team Behavior
    - Send issues directly to the planner (not just as return value):
      `SendMessage({ type: "message", recipient: "planner", content: "Issues found:\n1. {issue}\n2. {issue}\nPlease revise and notify me when ready for re-check.", summary: "Plan issues found, {N} items" })`
    - When planner messages that revisions are ready, re-read plans and re-verify
    - If verification passes, message the planner and update your task as completed
    ```

    **gsd-verifier.md** — Add after Communication Guidelines:
    ```
    ### Verifier-Specific Team Behavior
    - When you find a discrepancy between SUMMARY.md claims and actual codebase, query the executor:
      `SendMessage({ type: "message", recipient: "executor-{plan}", content: "SUMMARY.md claims {X} but I found {Y} in the codebase. Can you explain the discrepancy?", summary: "Verification discrepancy found" })`
    - Wait for executor response before marking a discrepancy as a gap (it may be intentional)
    - Write VERIFICATION.md as usual — the file is the persistent artifact
    ```

    **gsd-debugger.md** — Add after Communication Guidelines:
    ```
    ### Debugger-Specific Team Behavior (Competing Hypotheses)
    - When investigating as part of a debug team, actively challenge other investigators' hypotheses:
      `SendMessage({ type: "message", recipient: "investigator-{N}", content: "Your hypothesis '{H}' doesn't explain symptom {S}. Have you considered {alternative}?", summary: "Challenging hypothesis" })`
    - When your hypothesis is challenged, defend with evidence or acknowledge and revise
    - Share evidence broadly when it eliminates multiple hypotheses:
      `SendMessage({ type: "broadcast", content: "Evidence: {finding}. This eliminates hypotheses: {list}.", summary: "Evidence eliminates hypotheses" })`
    ```

    **gsd-project-researcher.md** — Add after Communication Guidelines:
    ```
    ### Project Researcher-Specific Team Behavior
    - When you discover something relevant to another researcher's domain, message them:
      `SendMessage({ type: "message", recipient: "{domain}-researcher", content: "My {domain} research found {X} which affects your {domain} research.", summary: "Cross-domain finding" })`
    - When the synthesizer asks for clarification, respond promptly via SendMessage
    ```

    **gsd-research-synthesizer.md** — Add after Communication Guidelines:
    ```
    ### Synthesizer-Specific Team Behavior
    - When research files have gaps or contradictions, message the specific researcher:
      `SendMessage({ type: "message", recipient: "{domain}-researcher", content: "Your {FILE}.md mentions {X} but conflicts with {FILE2}.md. Can you clarify?", summary: "Research clarification needed" })`
    - After synthesis is complete, notify all teammates that SUMMARY.md is ready
    ```

    **gsd-integration-checker.md** — Add after Communication Guidelines:
    ```
    ### Integration Checker-Specific Team Behavior
    - When cross-phase issues are found, message the relevant executor or verifier
    - Report integration findings to the team lead for coordination decisions
    ```

    **gsd-roadmapper.md and gsd-codebase-mapper.md** — These are typically single-agent workflows. Add a minimal note:
    ```
    ### Note on Team Context
    - This agent typically runs as a standalone subagent, not as a team member
    - If spawned into a team context, follow the base team protocol above
    - No agent-specific team behaviors needed for standalone operation
    ```

    IMPORTANT: Do NOT remove or modify any existing content in the agent files. Only APPEND the new section.
  </action>
  <verify>
    For each of the 11 agent files, verify:
    1. `grep -l "team_communication_protocol" ~/.claude/agents/gsd-*.md | wc -l` returns 11
    2. Each file still has its original `<role>` section intact
    3. No syntax errors in the XML-like tags
  </verify>
  <done>
    All 11 agent definitions contain a `<team_communication_protocol>` section with base protocol (task management, messaging, communication guidelines, file artifacts) plus agent-specific team behaviors where applicable. Original agent content is preserved unchanged.
  </done>
</task>

<task type="auto">
  <name>Task 2: Configure settings.json for Agent Teams teammate mode</name>
  <files>
    ~/.claude/settings.json
  </files>
  <action>
    Read `~/.claude/settings.json` and verify/update Agent Teams configuration.

    1. Verify `CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS` is set to `"1"` in `env` section (should already be present)
    2. Add `"teammateMode": "in-process"` at the top level of settings.json if not already present. In-process mode is recommended for programmatic workflows (no tmux dependency, same process).

    The final settings.json should have AT MINIMUM:
    ```json
    {
      "env": {
        "CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS": "1"
      },
      "teammateMode": "in-process",
      ...existing settings...
    }
    ```

    Do NOT remove or modify any other existing settings (hooks, plugins, includeCoAuthoredBy, etc.).
  </action>
  <verify>
    1. `cat ~/.claude/settings.json | jq '.env.CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS'` returns `"1"`
    2. `cat ~/.claude/settings.json | jq '.teammateMode'` returns `"in-process"`
    3. `cat ~/.claude/settings.json | jq '.hooks'` still has the existing SessionStart hooks
  </verify>
  <done>
    settings.json has Agent Teams enabled with in-process teammate mode. All existing settings (hooks, plugins, env vars) are preserved.
  </done>
</task>

</tasks>

<verification>
1. All 11 `~/.claude/agents/gsd-*.md` files contain `<team_communication_protocol>` section
2. Multi-agent agents (executor, planner, researcher, checker, verifier, debugger, project-researcher, synthesizer, integration-checker) have agent-specific team behaviors
3. Single-agent agents (roadmapper, codebase-mapper) have minimal team awareness notes
4. `~/.claude/settings.json` has `teammateMode: "in-process"` and `CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS: "1"`
5. No existing agent functionality or settings were removed or broken
</verification>

<success_criteria>
Every agent definition is team-ready with communication protocol. Settings enable Agent Teams with in-process mode. This unblocks all workflow migration plans.
</success_criteria>

<output>
After completion, create `.planning/phases/01.1-migrate-gsd-from-subagents-to-agent-teams/01.1-01-SUMMARY.md`
</output>
