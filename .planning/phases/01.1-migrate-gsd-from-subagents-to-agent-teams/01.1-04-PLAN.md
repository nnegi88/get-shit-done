---
phase: 01.1-migrate-gsd-from-subagents-to-agent-teams
plan: 04
type: execute
wave: 2
depends_on: [01.1-01]
files_modified:
  - ~/.claude/get-shit-done/workflows/new-project.md
autonomous: true

must_haves:
  truths:
    - "New-project workflow creates a research team with 4 parallel researchers, a synthesizer, and a roadmapper"
    - "Researchers can cross-pollinate findings by messaging each other during parallel research"
    - "Synthesizer can ask researchers for clarification before writing SUMMARY.md"
    - "Workflow falls back to current parallel subagent spawning if TeamCreate fails"
    - "All existing new-project functionality preserved (brownfield detection, questioning, PROJECT.md, config, requirements, roadmap)"
  artifacts:
    - path: "~/.claude/get-shit-done/workflows/new-project.md"
      provides: "Team-based project initialization with researcher cross-pollination"
      contains: "TeamCreate"
  key_links:
    - from: "~/.claude/get-shit-done/workflows/new-project.md"
      to: "~/.claude/agents/gsd-project-researcher.md"
      via: "Task() spawn with team_name for parallel researchers"
      pattern: "team_name.*gsd-init"
    - from: "~/.claude/get-shit-done/workflows/new-project.md"
      to: "~/.claude/agents/gsd-research-synthesizer.md"
      via: "Task() spawn with team_name for synthesizer"
      pattern: "team_name.*gsd-init"
---

<objective>
Migrate the new-project.md workflow from parallel-but-isolated subagent spawning to Agent Teams with researcher cross-pollination and synthesizer clarification capabilities.

Purpose: The current new-project workflow spawns 4 researchers in parallel but they cannot share findings. With Agent Teams, a stack researcher discovering that "auth requires Redis" can message the architecture researcher to factor this into infrastructure design. The synthesizer can ask researchers for clarification instead of guessing at contradictions.

Output: Rewritten new-project.md with team-based research phase and subagent fallback.
</objective>

<execution_context>
@/Users/naveennegi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/naveennegi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01.1-migrate-gsd-from-subagents-to-agent-teams/01.1-RESEARCH.md
@.planning/phases/01.1-migrate-gsd-from-subagents-to-agent-teams/CONTEXT.md
@.planning/phases/01.1-migrate-gsd-from-subagents-to-agent-teams/01.1-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rewrite new-project.md research phase for team-based cross-pollination with fallback</name>
  <files>
    ~/.claude/get-shit-done/workflows/new-project.md
  </files>
  <action>
    Rewrite the research phase (Step 6) of `new-project.md` to use Agent Teams while preserving ALL existing functionality. The research phase is the only section that benefits from team coordination. Steps 1-5 and 7-9 need minimal or no changes.

    **Steps that remain IDENTICAL:**
    - Auto mode detection (`<auto_mode>`)
    - Step 1 (Setup) — unchanged
    - Step 2 (Brownfield Offer) — unchanged
    - Step 3 (Deep Questioning) — unchanged
    - Step 4 (Write PROJECT.md) — unchanged
    - Step 5 (Workflow Preferences) and 5.5 (Resolve Model Profile) — unchanged
    - Step 7 (Define Requirements) — unchanged
    - Step 8 (Create Roadmap) — unchanged, roadmapper still spawned as standalone subagent (single-agent workflow, no team benefit)
    - Step 9 (Done) — unchanged
    - `<output>` and `<success_criteria>` — unchanged

    **Step 6 (Research Decision) — RESTRUCTURE for team mode:**

    After user selects "Research first":

    ```
    ## Team-Based Research (or Fallback)

    TeamCreate({ team_name: "gsd-init-{project_slug}", description: "Research team for new project initialization" })

    If TeamCreate succeeds — TEAM MODE:
    ```

    **Create tasks with dependency chain:**

    ```
    # 4 parallel research tasks (no dependencies between them — Wave 1)
    stack_task = TaskCreate({
      subject: "Research standard stack for {domain}",
      description: "Write STACK.md to .planning/research/STACK.md",
      activeForm: "Researching stack"
    })

    features_task = TaskCreate({
      subject: "Research features for {domain}",
      description: "Write FEATURES.md to .planning/research/FEATURES.md",
      activeForm: "Researching features"
    })

    architecture_task = TaskCreate({
      subject: "Research architecture for {domain}",
      description: "Write ARCHITECTURE.md to .planning/research/ARCHITECTURE.md",
      activeForm: "Researching architecture"
    })

    pitfalls_task = TaskCreate({
      subject: "Research pitfalls for {domain}",
      description: "Write PITFALLS.md to .planning/research/PITFALLS.md",
      activeForm: "Researching pitfalls"
    })

    # Synthesis task depends on all 4 research tasks (Wave 2)
    synthesis_task = TaskCreate({
      subject: "Synthesize research into SUMMARY.md",
      description: "Read all 4 research files, synthesize into .planning/research/SUMMARY.md, commit all research",
      activeForm: "Synthesizing research",
      addBlockedBy: [stack_task.id, features_task.id, architecture_task.id, pitfalls_task.id]
    })
    ```

    **Spawn researcher teammates:**

    ```
    Task(
      team_name: "gsd-init-{project_slug}",
      name: "stack-researcher",
      subagent_type: "gsd-project-researcher",
      prompt: "First, read /Users/naveennegi/.claude/agents/gsd-project-researcher.md for your role.\n\nYou are the STACK researcher on a research team. Check TaskList() for your task and claim it.\n\nIMPORTANT: You are working alongside 3 other researchers (features, architecture, pitfalls). If you discover something that affects their research, message them directly:\n- Architecture-relevant: SendMessage to 'architecture-researcher'\n- Feature-relevant: SendMessage to 'features-researcher'\n- Pitfall-relevant: SendMessage to 'pitfalls-researcher'\n\n" + existing_stack_research_prompt
    )

    Task(
      team_name: "gsd-init-{project_slug}",
      name: "features-researcher",
      subagent_type: "gsd-project-researcher",
      prompt: "First, read /Users/naveennegi/.claude/agents/gsd-project-researcher.md for your role.\n\nYou are the FEATURES researcher on a research team. Check TaskList() for your task.\n\nSame cross-pollination instructions as stack-researcher.\n\n" + existing_features_research_prompt
    )

    Task(
      team_name: "gsd-init-{project_slug}",
      name: "architecture-researcher",
      subagent_type: "gsd-project-researcher",
      prompt: "... same pattern..." + existing_architecture_research_prompt
    )

    Task(
      team_name: "gsd-init-{project_slug}",
      name: "pitfalls-researcher",
      subagent_type: "gsd-project-researcher",
      prompt: "... same pattern..." + existing_pitfalls_research_prompt
    )
    ```

    **Spawn synthesizer teammate:**

    ```
    Task(
      team_name: "gsd-init-{project_slug}",
      name: "synthesizer",
      subagent_type: "gsd-research-synthesizer",
      prompt: "You are the synthesizer on a research team. Check TaskList() for your task. It is blocked until all 4 researchers complete.\n\nIMPORTANT: If you find gaps or contradictions in research files, message the specific researcher for clarification:\n  SendMessage({ type: 'message', recipient: '{domain}-researcher', content: 'Your {FILE}.md says X but {FILE2}.md says Y. Which is correct?', summary: 'Research clarification needed' })\n\nWait for their response before finalizing SUMMARY.md.\n\nAfter writing SUMMARY.md, commit ALL research files.\n\n" + existing_synthesizer_prompt
    )
    ```

    **Orchestrator monitoring in team mode:**

    ```
    Monitor via TaskList():
    - When synthesis_task completes, research phase is done
    - Shutdown all teammates:
      For each teammate: SendMessage({ type: "shutdown_request", ... })
      Wait for responses
      TeamDelete()
    - Display research complete banner (same as current)
    - Continue to Step 7 (Requirements)
    ```

    **If TeamCreate fails — FALLBACK to current parallel subagent mode:**

    Display: `Agent Teams unavailable. Using parallel subagent mode.`

    Execute the EXACT current Step 6 code: spawn 4 parallel `Task()` researchers (fire-and-forget), wait for all 4, spawn synthesizer subagent. This is the existing implementation — preserve verbatim as fallback.

    **Key behavioral change in team mode:**

    | Aspect | Current (Parallel Subagents) | New (Research Team) |
    |--------|----------------------------|---------------------|
    | Researcher isolation | Completely isolated | Can message each other |
    | Cross-domain findings | Lost (each writes independently) | Broadcast or direct message |
    | Synthesizer clarification | Reads files, guesses at conflicts | Messages researchers for clarity |
    | Researcher task order | All parallel (unchanged) | All parallel via independent tasks |
    | Synthesizer dependency | Spawned after all complete | Task dependency via addBlockedBy |

    **Note on roadmapper:** The roadmapper (Step 8) remains a standalone subagent. It is a single-agent workflow that does not benefit from team coordination. No team is needed for roadmapping.

    **Preserve these existing behaviors exactly in both modes:**
    - Auto mode detection and behavior
    - Brownfield offer (Step 2)
    - Deep questioning (Step 3)
    - PROJECT.md creation (Step 4)
    - Config preferences (Step 5)
    - Research decision gate ("Research first" vs "Skip research")
    - Milestone context (greenfield vs subsequent)
    - Research file outputs (STACK.md, FEATURES.md, ARCHITECTURE.md, PITFALLS.md, SUMMARY.md)
    - Research complete banner display
    - Requirements definition (Step 7)
    - Roadmap creation (Step 8) — still standalone subagent
    - Done presentation (Step 9)
    - All commit points
  </action>
  <verify>
    1. `grep "TeamCreate" ~/.claude/get-shit-done/workflows/new-project.md` finds team creation
    2. `grep "cross-pollination\|cross.domain\|message.*researcher" ~/.claude/get-shit-done/workflows/new-project.md` finds cross-pollination instructions
    3. `grep "synthesizer.*clarification\|synthesizer.*SendMessage" ~/.claude/get-shit-done/workflows/new-project.md` finds synthesizer clarification pattern
    4. `grep "TeamDelete" ~/.claude/get-shit-done/workflows/new-project.md` finds cleanup
    5. `grep "fallback\|FALLBACK\|subagent mode" ~/.claude/get-shit-done/workflows/new-project.md` finds fallback path
    6. Steps 1-5 and 7-9 are preserved (init, brownfield, questioning, PROJECT.md, config, requirements, roadmap, done)
    7. Roadmapper is still spawned as standalone subagent (no team)
  </verify>
  <done>
    new-project.md creates a research team where 4 parallel researchers cross-pollinate findings via messaging and the synthesizer can ask researchers for clarification. Falls back to current parallel-but-isolated subagent mode if TeamCreate fails. All existing project initialization functionality preserved. Roadmapper remains standalone.
  </done>
</task>

</tasks>

<verification>
1. new-project.md Step 6 attempts TeamCreate for research team and falls back to current subagent mode
2. Team mode enables: researcher cross-pollination via messaging, synthesizer-researcher clarification
3. 4 researchers run in parallel (no cross-dependencies in TaskCreate)
4. Synthesizer blocked until all 4 researchers complete (addBlockedBy)
5. Roadmapper (Step 8) still spawned as standalone subagent
6. All existing steps (1-5, 7-9) unchanged
7. Auto mode, brownfield detection, questioning, configs, requirements, roadmap all work in both modes
</verification>

<success_criteria>
The new-project workflow enables researcher cross-pollination and synthesizer clarification through team messaging, with fallback to parallel-but-isolated subagent mode.
</success_criteria>

<output>
After completion, create `.planning/phases/01.1-migrate-gsd-from-subagents-to-agent-teams/01.1-04-SUMMARY.md`
</output>
