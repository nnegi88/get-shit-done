---
phase: 02-error-handling-security
plan: 03
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - get-shit-done/bin/gsd-tools.js
autonomous: true

must_haves:
  truths:
    - "Every empty catch block in gsd-tools.js is classified as intentional-fallback or bug"
    - "Bug catches now propagate, log, or throw structured errors instead of silently swallowing"
    - "Intentional-fallback catches have a comment explaining why the error is ignored"
    - "No behavior change for intentional fallbacks -- they still return the same default values"
  artifacts:
    - path: "get-shit-done/bin/gsd-tools.js"
      provides: "All 30 empty catch blocks classified and fixed"
      contains: "// Intentional: "
  key_links:
    - from: "catch blocks marked as bugs"
      to: "GsdError subclasses"
      via: "throw or error() with appropriate exit code"
      pattern: "catch.*\\{[^}]"
---

<objective>
Audit and fix all 30 empty catch blocks in gsd-tools.js by classifying each as intentional-fallback or bug and applying appropriate treatment.

Purpose: Eliminate silent failures that make debugging impossible. Bugs get error propagation; intentional fallbacks get documentation. This is requirement ERRH-01.
Output: Every empty catch block in gsd-tools.js classified and treated.
</objective>

<execution_context>
@/Users/naveennegi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/naveennegi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@get-shit-done/bin/gsd-tools.js
@.planning/phases/02-error-handling-security/02-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Classify all 30 empty catch blocks and fix bugs</name>
  <files>get-shit-done/bin/gsd-tools.js</files>
  <action>
    Audit every `catch {}` in gsd-tools.js. There are 30 empty catch blocks at approximately these lines: 545, 547, 958, 2482, 2630, 2700, 2768, 2826, 3008, 3117, 3120, 3224, 3286, 3306, 3350, 3694, 3705, 3716, 3727, 3751, 3832, 3870, 3980, 3982, 4029, 4031, 4040, 4079, 4155, 4163.

    NOTE: There are also 4 empty catches in hooks (gsd-statusline.js:62,78 and gsd-check-update.js:41,46). ALL 4 are intentional -- hooks must never break the user's terminal. These are OUT OF SCOPE for this task. If time permits, add `// Intentional: hook must fail silently` comments to them, but do NOT change their behavior.

    For EACH catch block, determine:

    **Classification rules:**

    A) **Intentional fallback** -- the catch returns a sensible default (null, empty array, false) and this is the correct behavior for the command:
    - `safeReadFile()` returning null on missing file -- INTENTIONAL (entire purpose of function)
    - `JSON.parse()` with fallback to raw string -- INTENTIONAL (graceful degradation)
    - Directory listing that returns empty array if dir doesn't exist -- INTENTIONAL
    - Config loading that uses defaults if file missing -- INTENTIONAL
    - Git operations where failure is non-critical -- INTENTIONAL

    For intentional fallbacks: Add `(e)` parameter and a comment:
    ```
    } catch (e) { // Intentional: <reason> -- returns <default> when <condition>
    ```
    Do NOT change the behavior. Do NOT add logging. The catch correctly handles the error by using a default.

    B) **Bug** -- the catch silently swallows an error that should be visible:
    - File write failures that report success -- BUG
    - JSON parse failures in commands expecting valid JSON -- BUG
    - Phase operations that silently fail -- BUG
    - Verification commands that silently skip broken files -- BUG

    For bugs: Add error handling using the error classes from Plan 01:
    ```
    } catch (e) {
      // Was: empty catch (silent failure)
      error(`Failed to <operation>: ${e.message}`, EXIT_FILESYSTEM);
    }
    ```
    Or for non-fatal bugs, add logging:
    ```
    } catch (e) {
      process.stderr.write(`Warning: <operation> failed: ${e.message}\n`);
    }
    ```

    **Expected classification distribution:**
    - Intentional fallbacks: ~20-22 (most are safeReadFile, optional config loading, directory checks)
    - Bugs to fix: ~8-10 (JSON parse failures, file write failures, phase operations)

    CRITICAL: For each catch you classify as intentional, verify the code path AFTER the catch confirms the default is used correctly (e.g., the `if (!content)` check after safeReadFile).

    CRITICAL: Do NOT change any return values or control flow for intentional catches. Only add the comment and `(e)` parameter.
  </action>
  <verify>
    1. Run `node --test get-shit-done/bin/gsd-tools.test.js` -- all tests pass
    2. Run `grep -c 'catch {}' get-shit-done/bin/gsd-tools.js` -- should return 0 (no more empty catches)
    3. Run `grep -c 'Intentional:' get-shit-done/bin/gsd-tools.js` -- should be 20+
    4. Run `grep -c 'catch (e)' get-shit-done/bin/gsd-tools.js` -- should be 30 (all catches now capture the error)
  </verify>
  <done>All 30 empty catch blocks classified. Zero empty catches remain. Intentional fallbacks documented with comments. Bug catches now propagate errors with appropriate exit codes or log warnings. All existing tests pass.</done>
</task>

<task type="auto">
  <name>Task 2: Create catch block classification audit table in SUMMARY</name>
  <files>get-shit-done/bin/gsd-tools.js</files>
  <action>
    As part of the SUMMARY.md for this plan, include a classification table documenting every catch block decision. This is for traceability -- future maintainers need to know WHY each catch was classified.

    The table format in SUMMARY.md:
    ```
    | Line | Function | Classification | Reason |
    |------|----------|----------------|--------|
    | ~545 | safeReadFile | intentional | Returns null for missing files, callers check for null |
    | ~958 | loadConfig | intentional | Falls back to default config when file missing |
    | ... | ... | ... | ... |
    ```

    This is documentation only -- no code changes in this task. The actual code changes happen in Task 1.

    NOTE: Record the actual line numbers AFTER Task 1 edits (they may shift slightly due to added comments).
  </action>
  <verify>SUMMARY.md contains a complete table with all 30 catch blocks classified.</verify>
  <done>Classification audit table exists in SUMMARY.md documenting every catch block's classification and reasoning.</done>
</task>

</tasks>

<verification>
1. `node --test get-shit-done/bin/gsd-tools.test.js` passes all existing tests
2. `grep -c 'catch {}' get-shit-done/bin/gsd-tools.js` returns 0
3. `grep -c 'catch (e)' get-shit-done/bin/gsd-tools.js` returns 30
4. Error recovery tests still produce the same behavior (JSON errors, missing file errors)
</verification>

<success_criteria>
- Zero empty catch blocks remain in gsd-tools.js
- Every catch block has a classification comment
- Bug catches propagate errors with structured error classes
- Intentional catches have documented reasoning
- All existing characterization tests pass unchanged
</success_criteria>

<output>
After completion, create `.planning/phases/02-error-handling-security/02-03-SUMMARY.md`
</output>
